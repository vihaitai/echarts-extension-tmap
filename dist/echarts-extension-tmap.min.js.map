{"version":3,"file":"echarts-extension-tmap.min.js","sources":["../src/helper.js","../src/TMapCoordSys.js","../src/TMapModel.js","../src/TMapView.js","../src/index.js","../index.js"],"sourcesContent":["import { version } from 'echarts/lib/echarts'\n\nexport const ecVer = version.split('.')\n\nexport const isNewEC = ecVer[0] > 4\n\nexport const COMPONENT_TYPE = 'tmap'\n\nexport function v2Equal(a, b) {\n  return a && b && a[0] === b[0] && a[1] === b[1]\n}\n\nlet logMap = {}\n\nexport function logWarn(tag, msg, once) {\n  const log = `[ECharts][Extension][TMap]${tag ? ' ' + tag + ':' : ''} ${msg}`\n  once && logMap[log] || console.warn(log)\n  once && (logMap[log] = true)\n}\n\nexport function clearLogMap() {\n  logMap = {}\n}\n","import { util as zrUtil, graphic, matrix } from 'echarts/lib/echarts'\nimport { COMPONENT_TYPE, logWarn } from './helper'\n\nfunction dataToCoordSize(dataSize, dataItem) {\n  dataItem = dataItem || [0, 0];\n  return zrUtil.map(\n    [0, 1],\n    function(dimIdx) {\n      const val = dataItem[dimIdx]\n      const halfSize = dataSize[dimIdx] / 2\n      const p1 = []\n      const p2 = []\n      p1[dimIdx] = val - halfSize\n      p2[dimIdx] = val + halfSize\n      p1[1 - dimIdx] = p2[1 - dimIdx] = dataItem[1 - dimIdx]\n      return Math.abs(\n        this.dataToPoint(p1)[dimIdx] - this.dataToPoint(p2)[dimIdx]\n      )\n    },\n    this\n  )\n}\n\nconst excludedOptions = [\n  'echartsLayerInteractive',\n  'renderOnMoving',\n  'largeMode',\n  'layers'\n]\n\nfunction TMapCoordSys(tmap, api) {\n  this._tmap = tmap\n  this._api = api\n  this._mapOffset = [0, 0]\n}\n\nconst TMapCoordSysProto = TMapCoordSys.prototype\n\nTMapCoordSysProto.setZoom = function(zoom) {\n  this._zoom = zoom\n}\n\nTMapCoordSysProto.setCenter = function(center) {\n  const lnglat = new T.LngLat(center[0], center[1])\n  this._center = this._tmap.lngLatToContainerPoint(lnglat)\n}\n\nTMapCoordSysProto.setMapOffset = function(mapOffset) {\n  this._mapOffset = mapOffset\n}\n\nTMapCoordSysProto.setTMap = function(tmap) {\n  this._tmap = tmap\n}\n\nTMapCoordSysProto.getTMap = function() {\n  return this._tmap\n}\n\nTMapCoordSysProto.dataToPoint = function(data) {\n  const lnglat = new T.LngLat(data[0], data[1])\n  const px = this._tmap.lngLatToContainerPoint(lnglat)\n  const mapOffset = this._mapOffset\n  return [px.x - mapOffset[0], px.y - mapOffset[1]]\n}\n\nTMapCoordSysProto.pointToData = function(pt) {\n  const mapOffset = this._mapOffset\n  const lnglat = this._tmap.containerPointToLngLat(\n    new T.Point(\n      pt[0] + mapOffset[0],\n      pt[1] + mapOffset[1]\n    )\n  )\n  return [lnglat.lng, lnglat.lat]\n}\n\nTMapCoordSysProto.getViewRect = function() {\n  const api = this._api\n  return new graphic.BoundingRect(0, 0, api.getWidth(), api.getHeight())\n}\n\nTMapCoordSysProto.getRoamTransform = function() {\n  return matrix.create()\n}\n\nTMapCoordSysProto.prepareCustoms = function() {\n  const rect = this.getViewRect()\n  return {\n    coordSys: {\n      type: COMPONENT_TYPE,\n      x: rect.x,\n      y: rect.y,\n      width: rect.width,\n      height: rect.height\n    },\n    api: {\n      coord: zrUtil.bind(this.dataToPoint, this),\n      size: zrUtil.bind(dataToCoordSize, this) // TODO: FIXME\n    }\n  }\n}\n\nTMapCoordSysProto.convertToPixel = function(ecModel, finder, value) {\n  // here we don't use finder as only one tmap component is allowed\n  return this.dataToPoint(value);\n}\n\nTMapCoordSysProto.convertFromPixel = function(ecModel, finder, value) {\n  // here we don't use finder as only one tmap component is allowed\n  return this.pointToData(value);\n}\n\n// less useful\n// TMapCoordSysProto.containPoint = function(point) {\n//   return this._tmap.getBounds().contains(this.pointToData(point));\n// }\n\nTMapCoordSys.create = function(ecModel, api) {\n  let tmapCoordSys\n  ecModel.eachComponent(COMPONENT_TYPE, function(tmapModel) {\n    if (typeof T === 'undefined') {\n      throw new Error('T api is not loaded')\n    }\n    if (tmapCoordSys) {\n      throw new Error('Only one tmap component is allowed')\n    }\n    let tmap = tmapModel.getTMap()\n    const echartsLayerInteractive = tmapModel.get('echartsLayerInteractive')\n    if (!tmap) {\n      const root = api.getDom()\n      const painter = api.getZr().painter\n      const viewportRoot = painter.getViewportRoot()\n      viewportRoot.className = COMPONENT_TYPE + '-ec-layer'\n      // PENDING not hidden?\n      viewportRoot.style.visibility = 'hidden'\n      const className = 'ec-extension-' + COMPONENT_TYPE\n      // Not support IE8\n      let tmapRoot = root.querySelector('.' + className)\n      if (tmapRoot) {\n        // Reset viewport left and top, which will be changed\n        // in moving handler in tmapView\n        viewportRoot.style.left = '0px'\n        viewportRoot.style.top = '0px'\n        root.removeChild(tmapRoot)\n      }\n      tmapRoot = document.createElement('div')\n      tmapRoot.className = className\n      tmapRoot.style.cssText = 'position:absolute;top:0;left:0;bottom:0;right:0;'\n      root.appendChild(tmapRoot)\n\n      const options = zrUtil.clone(tmapModel.get())\n      // delete excluded options\n      zrUtil.each(excludedOptions, function(key) {\n        delete options[key]\n      })\n\n      tmap = new T.Map(tmapRoot, options)\n\n      const nativeSetMapStyle = tmap.setStyle\n      tmap.setStyle = function () {\n        let style = arguments[0]\n        logWarn('style', style)\n        nativeSetMapStyle.apply(this, arguments)\n        tmapModel.__mapStyle = style\n      }\n\n      setTimeout(() => {\n        tmapRoot.appendChild(viewportRoot)\n        viewportRoot.style.visibility = ''\n        viewportRoot.style.zIndex = 1000\n      }, 10 * 2)\n      tmapModel.setTMap(tmap)\n      tmapModel.setRoot(tmapRoot)\n      tmapModel.setEChartsLayer(viewportRoot)\n\n      // Override\n      painter.getViewportRootOffset = function() {\n        return { offsetLeft: 0, offsetTop: 0 }\n      }\n    }\n\n    const oldEChartsLayerInteractive = tmapModel.__echartsLayerInteractive\n    if (oldEChartsLayerInteractive !== echartsLayerInteractive) {\n      tmapModel.setEChartsLayerInteractive(echartsLayerInteractive)\n      tmapModel.__echartsLayerInteractive = echartsLayerInteractive\n    }\n\n    const center = tmapModel.get('center')\n    const zoom = tmapModel.get('zoom')\n    if (center && zoom) {\n      const tmapCenter = tmap.getCenter()\n      const tmapZoom = tmap.getZoom()\n      const centerOrZoomChanged = tmapModel.centerOrZoomChanged(\n        [tmapCenter.lng, tmapCenter.lat],\n        tmapZoom\n      )\n      if (centerOrZoomChanged) {\n        tmap.centerAndZoom(new T.LngLat(center[0], center[1]), zoom)\n      }\n    }\n\n    // update map style(#13)\n    const originalMapStyle = tmapModel.__mapStyle\n    const newMapStyle = tmapModel.get('mapStyle')\n    if (originalMapStyle !== newMapStyle) {\n      tmap.setStyle(tmapModel.__mapStyle = newMapStyle)\n    }\n\n    tmapCoordSys = new TMapCoordSys(tmap, api)\n    tmapCoordSys.setMapOffset(tmapModel.__mapOffset || [0, 0])\n    tmapCoordSys.setZoom(zoom)\n    tmapCoordSys.setCenter(center)\n\n    tmapModel.coordinateSystem = tmapCoordSys\n  })\n\n  ecModel.eachSeries(function(seriesModel) {\n    if (seriesModel.get('coordinateSystem') === COMPONENT_TYPE) {\n      // inject coordinate system\n      seriesModel.coordinateSystem = tmapCoordSys\n    }\n  })\n\n  // return created coordinate systems\n  return tmapCoordSys && [tmapCoordSys]\n}\n\nTMapCoordSysProto.dimensions = TMapCoordSys.dimensions = ['lng', 'lat']\n\nTMapCoordSysProto.type = COMPONENT_TYPE\n\n\nexport default TMapCoordSys\n","import { ComponentModel } from 'echarts/lib/echarts'\nimport { COMPONENT_TYPE, isNewEC, v2Equal } from './helper'\n\nconst TMapModel = {\n  type: COMPONENT_TYPE,\n\n  setTMap(tmap) {\n    this.__tmap = tmap\n  },\n\n  getTMap() {\n    return this.__tmap\n  },\n\n  setRoot(root) {\n    this.__root = root\n  },\n\n  getRoot(root) {\n    return this.__root\n  },\n\n  setEChartsLayer(layer) {\n    this.__echartsLayer = layer\n  },\n\n  getEChartsLayer() {\n    return this.__echartsLayer\n  },\n\n  setEChartsLayerVisibility(visible) {\n    this.__echartsLayer.style.display = visible ? 'block' : 'none'\n  },\n\n  // FIXME: NOT SUPPORT <= IE 10\n  setEChartsLayerInteractive(interactive) {\n    this.option.echartsLayerInteractive = !!interactive\n    this.__echartsLayer.style.pointerEvents = interactive ? 'auto' : 'none'\n  },\n\n  setCenterAndZoom(center, zoom) {\n    this.option.center = center\n    this.option.zoom = zoom\n  },\n\n  centerOrZoomChanged(center, zoom) {\n    const option = this.option\n    return !(v2Equal(center, option.center) && zoom === option.zoom)\n  },\n\n  defaultOption: {\n    center: [116.397428, 39.90923],\n    zoom: 5,\n    resizeEnable: true,\n    // extension specific options\n    echartsLayerInteractive: true,\n    renderOnMoving: false,\n    largeMode: false,\n  }\n}\n\nexport default isNewEC\n  ? ComponentModel.extend(TMapModel)\n  : TMapModel\n","import { ComponentView, getInstanceByDom, throttle } from \"echarts/lib/echarts\";\nimport { COMPONENT_TYPE, isNewEC, clearLogMap } from \"./helper\";\n\nconst TMapView = {\n  type: COMPONENT_TYPE,\n\n  init() {\n    this._isFirstRender = true;\n  },\n\n  render(tmapModel, ecModel, api) {\n    let rendering = true;\n\n    const tmap = tmapModel.getTMap();\n    const viewportRoot = api.getZr().painter.getViewportRoot();\n    const offsetEl = tmapModel.getRoot();\n    const coordSys = tmapModel.coordinateSystem;\n\n    const renderOnMoving = tmapModel.get(\"renderOnMoving\");\n    const resizeEnable = tmapModel.get(\"resizeEnable\");\n    const largeMode = tmapModel.get(\"largeMode\");\n\n    let moveHandler = function (e) {\n      if (rendering) {\n        return;\n      }\n\n      const offsetElStyle = offsetEl.style;\n      const mapOffset = [\n        -parseInt(offsetElStyle.left, 10) || 0,\n        -parseInt(offsetElStyle.top, 10) || 0,\n      ];\n      // only update style when map offset changed\n      const viewportRootStyle = viewportRoot.style;\n      const offsetLeft = mapOffset[0] + \"px\";\n      const offsetTop = mapOffset[1] + \"px\";\n      if (viewportRootStyle.left !== offsetLeft) {\n        viewportRootStyle.left = offsetLeft;\n      }\n      if (viewportRootStyle.top !== offsetTop) {\n        viewportRootStyle.top = offsetTop;\n      }\n      coordSys.setMapOffset((tmapModel.__mapOffset = mapOffset));\n      const actionParams = {\n        type: \"tmapRoam\",\n        animation: {\n          // compatible with ECharts 5.x\n          // no delay for rendering but remain animation of elements\n          duration: 0,\n        },\n      };\n      api.dispatchAction(actionParams);\n    };\n\n    if (this._moveHandlerPerformance) {\n      tmap.off(\"move\", this._moveHandlerPerformance);\n    }\n    // 移除上一次监听\n    if (this._resizeHandler) {\n      tmap.off(\"resize\", this._resizeHandler);\n    }\n    if (this._moveStartHandler) {\n      tmap.off(\"movestart\", this._moveStartHandler);\n    }\n    if (this._moveEndHandler) {\n      tmap.off(\"moveend\", this._moveEndHandler);\n      tmap.off(\"zoomend\", this._moveEndHandler);\n    }\n\n    if (!renderOnMoving) {\n      this._moveStartHandler = () => {\n        setTimeout(function () {\n          tmapModel.setEChartsLayerVisibility(false);\n        }, 0);\n      };\n      tmap.on(\"movestart\", this._moveStartHandler);\n    } else {\n      this._moveHandlerPerformance = throttle(moveHandler, 14, true);\n      tmap.on(\"move\", this._moveHandlerPerformance);\n    }\n    // 移动结束渲染\n    this._moveEndHandler = (e) => {\n      moveHandler(e);\n      // 展示隐藏图层\n      if (!renderOnMoving) {\n        setTimeout(function () {\n          tmapModel.setEChartsLayerVisibility(true);\n        }, 0);\n      }\n    };\n    tmap.on(\"moveend\", this._moveEndHandler);\n    tmap.on(\"zoomend\", this._moveEndHandler);\n\n    if (resizeEnable) {\n      let resizeHandler = function () {\n        getInstanceByDom(api.getDom()).resize();\n      };\n      if (largeMode) {\n        resizeHandler = throttle(resizeHandler, 20, true);\n      }\n      tmap.on(\"resize\", (this._resizeHandler = resizeHandler));\n    }\n\n    this._isFirstRender = rendering = false;\n  },\n\n  dispose() {\n    clearLogMap();\n    const component = this.__model;\n    if (component) {\n      const root = component.getRoot();\n      if (root) {\n        root.innerHTML = \"\";\n      }\n      component.setTMap(null);\n      component.setEChartsLayer(null);\n      if (component.coordinateSystem) {\n        component.coordinateSystem.setTMap(null);\n        component.coordinateSystem = null;\n      }\n      delete this._resizeHandler;\n      delete this._moveStartHandler;\n      delete this._moveEndHandler;\n      delete this._moveHandlerPerformance;\n    }\n  },\n};\n\nexport default isNewEC ? ComponentView.extend(TMapView) : TMapView;\n","import TMapCoordSys from './TMapCoordSys'\nimport TMapModel from './TMapModel'\nimport TMapView from './TMapView'\nimport { isNewEC, ecVer, COMPONENT_TYPE } from './helper'\n\nexport { version, name } from '../package.json'\n\nexport function install(registers) {\n  // add coordinate system support for pie series for ECharts < 5.4.0\n  if (!isNewEC || (ecVer[0] == 5 && ecVer[1] < 4)) {\n    registers.registerLayout(function(ecModel) {\n      ecModel.eachSeriesByType('pie', function (seriesModel) {\n        const coordSys = seriesModel.coordinateSystem\n        const data = seriesModel.getData()\n        const valueDim = data.mapDimension('value')\n        if (coordSys && coordSys.type === COMPONENT_TYPE) {\n          const center = seriesModel.get('center')\n          const point = coordSys.dataToPoint(center)\n          const cx = point[0]\n          const cy = point[1]\n          data.each(valueDim, function (value, idx) {\n            const layout = data.getItemLayout(idx)\n            layout.cx = cx\n            layout.cy = cy\n          })\n        }\n      })\n    })\n  }\n  // Model\n  isNewEC\n    ? registers.registerComponentModel(TMapModel)\n    : registers.extendComponentModel(TMapModel)\n  // View\n  isNewEC\n    ? registers.registerComponentView(TMapView)\n    : registers.extendComponentView(TMapView)\n  // Coordinate System\n  registers.registerCoordinateSystem(COMPONENT_TYPE, TMapCoordSys)\n  // Action\n  registers.registerAction(\n    {\n      type: COMPONENT_TYPE + 'Roam',\n      event: COMPONENT_TYPE + 'Roam',\n      update: 'updateLayout'\n    },\n    function(payload, ecModel) {\n      ecModel.eachComponent(COMPONENT_TYPE, function(tmapModel) {\n        const tmap = tmapModel.getTMap()\n        const center = tmap.getCenter()\n        tmapModel.setCenterAndZoom([center.lng, center.lat], tmap.getZoom())\n      })\n    }\n  )\n}\n","/**\n * TODO use `echarts/core` rather than `echarts/lib/echarts`\n * to avoid self-registered `CanvasRenderer` and `DataSetComponent` in Apache ECharts 5\n * but it's not compatible with echarts v4. Leave it to 2.0.\n */\nimport * as echarts from 'echarts/lib/echarts'\nimport { install } from './src/index'\nimport { isNewEC } from './src/helper'\n\nisNewEC ? echarts.use(install) : install(echarts)\n\nexport { name, version } from './src/index'\n"],"names":["ecVer","version","split","isNewEC","COMPONENT_TYPE","logMap","dataToCoordSize","dataSize","dataItem","zrUtil","map","dimIdx","val","halfSize","p1","p2","Math","abs","this","dataToPoint","excludedOptions","TMapCoordSys","tmap","api","_tmap","_api","_mapOffset","TMapCoordSysProto","prototype","setZoom","zoom","_zoom","setCenter","center","lnglat","T","LngLat","_center","lngLatToContainerPoint","setMapOffset","mapOffset","setTMap","getTMap","data","px","x","y","pointToData","pt","containerPointToLngLat","Point","lng","lat","getViewRect","graphic","BoundingRect","getWidth","getHeight","getRoamTransform","matrix","create","prepareCustoms","rect","coordSys","type","width","height","coord","bind","size","util","convertToPixel","ecModel","finder","value","convertFromPixel","tmapCoordSys","eachComponent","tmapModel","Error","echartsLayerInteractive","get","root","getDom","painter","getZr","viewportRoot","getViewportRoot","className","style","visibility","tmapRoot","querySelector","left","top","removeChild","document","createElement","cssText","appendChild","options","clone","each","key","nativeSetMapStyle","Map","setStyle","tag","msg","once","log","arguments","concat","console","warn","apply","__mapStyle","setTimeout","zIndex","setRoot","setEChartsLayer","getViewportRootOffset","offsetLeft","offsetTop","__echartsLayerInteractive","setEChartsLayerInteractive","tmapCenter","getCenter","tmapZoom","getZoom","centerOrZoomChanged","centerAndZoom","originalMapStyle","newMapStyle","__mapOffset","coordinateSystem","eachSeries","seriesModel","dimensions","TMapModel","__tmap","__root","getRoot","layer","__echartsLayer","getEChartsLayer","setEChartsLayerVisibility","visible","display","interactive","option","pointerEvents","setCenterAndZoom","a","b","defaultOption","resizeEnable","renderOnMoving","largeMode","ComponentModel","extend","TMapView","init","_isFirstRender","render","rendering","offsetEl","moveHandler","e","offsetElStyle","parseInt","viewportRootStyle","dispatchAction","animation","duration","_moveHandlerPerformance","off","_resizeHandler","_moveStartHandler","_moveEndHandler","throttle","on","resizeHandler","getInstanceByDom","resize","dispose","component","__model","innerHTML","ComponentView","install","registers","registerLayout","eachSeriesByType","getData","valueDim","mapDimension","point","cx","cy","idx","layout","getItemLayout","registerComponentModel","extendComponentModel","registerComponentView","extendComponentView","registerCoordinateSystem","registerAction","event","update","payload","echarts","use"],"mappings":"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"}