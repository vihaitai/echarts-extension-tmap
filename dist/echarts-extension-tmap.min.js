/*!
 * echarts-extension-tmap 
 * @version 1.0.0
 * @author undefined
 * 
 * MIT License
 * 
 * Copyright (c) 2019-2022 Zhongxiang Wang
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("echarts/lib/echarts")):"function"==typeof define&&define.amd?define(["exports","echarts/lib/echarts"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).echarts=t.echarts||{},t.echarts.amap={}),t.echarts)}(this,(function(t,e){"use strict";var n=e.version.split("."),o=n[0]>4,i="tmap";var r={};function a(t,n){return n=n||[0,0],e.util.map([0,1],(function(e){var o=n[e],i=t[e]/2,r=[],a=[];return r[e]=o-i,a[e]=o+i,r[1-e]=a[1-e]=n[1-e],Math.abs(this.dataToPoint(r)[e]-this.dataToPoint(a)[e])}),this)}var s=["echartsLayerInteractive","renderOnMoving","largeMode","layers"];function c(t,e){this._tmap=t,this._api=e,this._mapOffset=[0,0]}var h=c.prototype;h.setZoom=function(t){this._zoom=t},h.setCenter=function(t){var e=new T.LngLat(t[0],t[1]);this._center=this._tmap.lngLatToContainerPoint(e)},h.setMapOffset=function(t){this._mapOffset=t},h.setTMap=function(t){this._tmap=t},h.getTMap=function(){return this._tmap},h.dataToPoint=function(t){var e=new T.LngLat(t[0],t[1]),n=this._tmap.lngLatToContainerPoint(e),o=this._mapOffset;return[n.x-o[0],n.y-o[1]]},h.pointToData=function(t){var e=this._mapOffset,n=this._tmap.containerPointToLngLat(new T.Point(t[0]+e[0],t[1]+e[1]));return[n.lng,n.lat]},h.getViewRect=function(){var t=this._api;return new e.graphic.BoundingRect(0,0,t.getWidth(),t.getHeight())},h.getRoamTransform=function(){return e.matrix.create()},h.prepareCustoms=function(){var t=this.getViewRect();return{coordSys:{type:i,x:t.x,y:t.y,width:t.width,height:t.height},api:{coord:e.util.bind(this.dataToPoint,this),size:e.util.bind(a,this)}}},h.convertToPixel=function(t,e,n){return this.dataToPoint(n)},h.convertFromPixel=function(t,e,n){return this.pointToData(n)},c.create=function(t,n){var o;return t.eachComponent(i,(function(t){if("undefined"==typeof T)throw new Error("T api is not loaded");if(o)throw new Error("Only one tmap component is allowed");var a=t.getTMap(),h=t.get("echartsLayerInteractive");if(!a){var l=n.getDom(),f=n.getZr().painter,m=f.getViewportRoot();m.className=i+"-ec-layer",m.style.visibility="hidden";var d="ec-extension-"+i,p=l.querySelector("."+d);p&&(m.style.left="0px",m.style.top="0px",l.removeChild(p)),(p=document.createElement("div")).className=d,p.style.cssText="position:absolute;top:0;left:0;bottom:0;right:0;",l.appendChild(p);var u=e.util.clone(t.get());e.util.each(s,(function(t){delete u[t]}));var y=(a=new T.Map(p,u)).setStyle;a.setStyle=function(){var e,n,o,i,a=arguments[0];n=a,i="[ECharts][Extension][TMap]".concat((e="style")?" "+e+":":""," ").concat(n),o&&r[i]||console.warn(i),o&&(r[i]=!0),y.apply(this,arguments),t.__mapStyle=a},setTimeout((function(){p.appendChild(m),m.style.visibility="",m.style.zIndex=1e3}),20),t.setTMap(a),t.setRoot(p),t.setEChartsLayer(m),f.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}t.__echartsLayerInteractive!==h&&(t.setEChartsLayerInteractive(h),t.__echartsLayerInteractive=h);var v=t.get("center"),g=t.get("zoom");if(v&&g){var _=a.getCenter(),L=a.getZoom();t.centerOrZoomChanged([_.lng,_.lat],L)&&a.centerAndZoom(new T.LngLat(v[0],v[1]),g)}var C=t.__mapStyle,M=t.get("mapStyle");C!==M&&a.setStyle(t.__mapStyle=M),(o=new c(a,n)).setMapOffset(t.__mapOffset||[0,0]),o.setZoom(g),o.setCenter(v),t.coordinateSystem=o})),t.eachSeries((function(t){t.get("coordinateSystem")===i&&(t.coordinateSystem=o)})),o&&[o]},h.dimensions=c.dimensions=["lng","lat"],h.type=i;var l={type:i,setTMap:function(t){this.__tmap=t},getTMap:function(){return this.__tmap},setRoot:function(t){this.__root=t},getRoot:function(t){return this.__root},setEChartsLayer:function(t){this.__echartsLayer=t},getEChartsLayer:function(){return this.__echartsLayer},setEChartsLayerVisibility:function(t){this.__echartsLayer.style.display=t?"block":"none"},setEChartsLayerInteractive:function(t){this.option.echartsLayerInteractive=!!t,this.__echartsLayer.style.pointerEvents=t?"auto":"none"},setCenterAndZoom:function(t,e){this.option.center=t,this.option.zoom=e},centerOrZoomChanged:function(t,e){var n,o,i=this.option;return o=i.center,!((n=t)&&o&&n[0]===o[0]&&n[1]===o[1]&&e===i.zoom)},defaultOption:{center:[116.397428,39.90923],zoom:5,resizeEnable:!0,echartsLayerInteractive:!0,renderOnMoving:!1,largeMode:!1}},f=o?e.ComponentModel.extend(l):l,m={type:i,init:function(){this._isFirstRender=!0},render:function(t,n,o){var i=!0,r=t.getTMap(),a=o.getZr().painter.getViewportRoot(),s=t.getRoot(),c=t.coordinateSystem,h=t.get("renderOnMoving"),l=t.get("resizeEnable"),f=t.get("largeMode"),m=function(e){if(!i){var n=s.style,r=[-parseInt(n.left,10)||0,-parseInt(n.top,10)||0],h=a.style,l=r[0]+"px",f=r[1]+"px";h.left!==l&&(h.left=l),h.top!==f&&(h.top=f),c.setMapOffset(t.__mapOffset=r);o.dispatchAction({type:"tmapRoam",animation:{duration:0}})}};if(this._moveHandlerPerformance&&r.off("move",this._moveHandlerPerformance),this._resizeHandler&&r.off("resize",this._resizeHandler),this._moveStartHandler&&r.off("movestart",this._moveStartHandler),this._moveEndHandler&&(r.off("moveend",this._moveEndHandler),r.off("zoomend",this._moveEndHandler)),h?(this._moveHandlerPerformance=e.throttle(m,14,!0),r.on("move",this._moveHandlerPerformance)):(this._moveStartHandler=function(){setTimeout((function(){t.setEChartsLayerVisibility(!1)}),0)},r.on("movestart",this._moveStartHandler)),this._moveEndHandler=function(e){m(),h||setTimeout((function(){t.setEChartsLayerVisibility(!0)}),0)},r.on("moveend",this._moveEndHandler),r.on("zoomend",this._moveEndHandler),l){var d=function(){e.getInstanceByDom(o.getDom()).resize()};f&&(d=e.throttle(d,20,!0)),r.on("resize",this._resizeHandler=d)}this._isFirstRender=i=!1},dispose:function(){r={};var t=this.__model;if(t){var e=t.getRoot();e&&(e.innerHTML=""),t.setTMap(null),t.setEChartsLayer(null),t.coordinateSystem&&(t.coordinateSystem.setTMap(null),t.coordinateSystem=null),delete this._resizeHandler,delete this._moveStartHandler,delete this._moveEndHandler,delete this._moveHandlerPerformance}}},d=o?e.ComponentView.extend(m):m;function p(t){(!o||5==n[0]&&n[1]<4)&&t.registerLayout((function(t){t.eachSeriesByType("pie",(function(t){var e=t.coordinateSystem,n=t.getData(),o=n.mapDimension("value");if(e&&e.type===i){var r=t.get("center"),a=e.dataToPoint(r),s=a[0],c=a[1];n.each(o,(function(t,e){var o=n.getItemLayout(e);o.cx=s,o.cy=c}))}}))})),o?t.registerComponentModel(f):t.extendComponentModel(f),o?t.registerComponentView(d):t.extendComponentView(d),t.registerCoordinateSystem(i,c),t.registerAction({type:i+"Roam",event:i+"Roam",update:"updateLayout"},(function(t,e){e.eachComponent(i,(function(t){var e=t.getTMap(),n=e.getCenter();t.setCenterAndZoom([n.lng,n.lat],e.getZoom())}))}))}o?e.use(p):p(e),t.name="echarts-extension-tmap",t.version="1.0.0"}));
//# sourceMappingURL=echarts-extension-tmap.min.js.map
