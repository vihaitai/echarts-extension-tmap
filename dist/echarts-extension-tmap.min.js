/*!
 * echarts-extension-tmap 
 * @version 1.0.0
 * @author undefined
 * 
 * MIT License
 * 
 * Copyright (c) 2019-2022 Zhongxiang Wang
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("echarts/lib/echarts")):"function"==typeof define&&define.amd?define(["exports","echarts/lib/echarts"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).echarts=e.echarts||{},e.echarts.amap={}),e.echarts)}(this,(function(e,t){"use strict";var n=t.version.split("."),o=n[0]>4,i="tmap";var r={};function a(e,n){return n=n||[0,0],t.util.map([0,1],(function(t){var o=n[t],i=e[t]/2,r=[],a=[];return r[t]=o-i,a[t]=o+i,r[1-t]=a[1-t]=n[1-t],Math.abs(this.dataToPoint(r)[t]-this.dataToPoint(a)[t])}),this)}var s=["echartsLayerInteractive","renderOnMoving","largeMode","layers"];function c(e,t){this._tmap=e,this._api=t,this._mapOffset=[0,0]}var l=c.prototype;l.setZoom=function(e){this._zoom=e},l.setCenter=function(e){var t=new T.LngLat(e[0],e[1]);this._center=this._tmap.lngLatToContainerPoint(t)},l.setMapOffset=function(e){this._mapOffset=e},l.setTMap=function(e){this._tmap=e},l.getTMap=function(){return this._tmap},l.dataToPoint=function(e){var t=new T.LngLat(e[0],e[1]),n=this._tmap.lngLatToContainerPoint(t),o=this._mapOffset;return[n.x-o[0],n.y-o[1]]},l.pointToData=function(e){var t=this._mapOffset,n=this._tmap.containerPointToLngLat(new T.Point(e[0]+t[0],e[1]+t[1]));return[n.lng,n.lat]},l.getViewRect=function(){var e=this._api;return new t.graphic.BoundingRect(0,0,e.getWidth(),e.getHeight())},l.getRoamTransform=function(){return t.matrix.create()},l.prepareCustoms=function(){var e=this.getViewRect();return{coordSys:{type:i,x:e.x,y:e.y,width:e.width,height:e.height},api:{coord:t.util.bind(this.dataToPoint,this),size:t.util.bind(a,this)}}},l.convertToPixel=function(e,t,n){return this.dataToPoint(n)},l.convertFromPixel=function(e,t,n){return this.pointToData(n)},c.create=function(e,n){var o;return e.eachComponent(i,(function(e){if("undefined"==typeof T)throw new Error("T api is not loaded");if(o)throw new Error("Only one tmap component is allowed");var a=e.getTMap(),l=e.get("echartsLayerInteractive");if(!a){var h=n.getDom(),f=n.getZr().painter,m=f.getViewportRoot();m.className=i+"-ec-layer",m.style.visibility="hidden";var d="ec-extension-"+i,p=h.querySelector("."+d);p&&(m.style.left="0px",m.style.top="0px",h.removeChild(p)),(p=document.createElement("div")).className=d,p.style.cssText="position:absolute;top:0;left:0;bottom:0;right:0;",h.appendChild(p);var u=t.util.clone(e.get());t.util.each(s,(function(e){delete u[e]}));var y=(a=new T.Map(p,u)).setStyle;a.setStyle=function(){var t,n,o,i,a=arguments[0];n=a,i="[ECharts][Extension][TMap]".concat((t="style")?" "+t+":":""," ").concat(n),o&&r[i]||console.warn(i),o&&(r[i]=!0),y.apply(this,arguments),e.__mapStyle=a},setTimeout((function(){p.appendChild(m),m.style.visibility="",m.style.zIndex=1e3}),20),e.setTMap(a),e.setRoot(p),e.setEChartsLayer(m),f.getViewportRootOffset=function(){return{offsetLeft:0,offsetTop:0}}}e.__echartsLayerInteractive!==l&&(e.setEChartsLayerInteractive(l),e.__echartsLayerInteractive=l);var v=e.get("center"),g=e.get("zoom");if(v&&g){var _=a.getCenter(),L=a.getZoom();e.centerOrZoomChanged([_.lng,_.lat],L)&&a.centerAndZoom(new T.LngLat(v[0],v[1]),g)}var C=e.__mapStyle,M=e.get("mapStyle");C!==M&&a.setStyle(e.__mapStyle=M),(o=new c(a,n)).setMapOffset(e.__mapOffset||[0,0]),o.setZoom(g),o.setCenter(v),e.coordinateSystem=o})),e.eachSeries((function(e){e.get("coordinateSystem")===i&&(e.coordinateSystem=o)})),o&&[o]},l.dimensions=c.dimensions=["lng","lat"],l.type=i;var h={type:i,setTMap:function(e){this.__tmap=e},getTMap:function(){return this.__tmap},setRoot:function(e){this.__root=e},getRoot:function(e){return this.__root},setEChartsLayer:function(e){this.__echartsLayer=e},getEChartsLayer:function(){return this.__echartsLayer},setEChartsLayerVisibility:function(e){this.__echartsLayer.style.display=e?"block":"none"},setEChartsLayerInteractive:function(e){this.option.echartsLayerInteractive=!!e,this.__echartsLayer.style.pointerEvents=e?"auto":"none"},setCenterAndZoom:function(e,t){this.option.center=e,this.option.zoom=t},centerOrZoomChanged:function(e,t){var n,o,i=this.option;return o=i.center,!((n=e)&&o&&n[0]===o[0]&&n[1]===o[1]&&t===i.zoom)},defaultOption:{center:[116.397428,39.90923],zoom:5,resizeEnable:!0,echartsLayerInteractive:!0,renderOnMoving:!1,largeMode:!1}},f=o?t.ComponentModel.extend(h):h,m={type:i,init:function(){this._isFirstRender=!0},render:function(e,n,o){var i=!0,r=e.getTMap(),a=o.getZr().painter.getViewportRoot(),s=e.getRoot(),c=e.coordinateSystem,l=e.get("renderOnMoving"),h=e.get("resizeEnable"),f=e.get("largeMode"),m=function(t){if(!i){var n=s.style,r=[-parseInt(n.left,10)||0,-parseInt(n.top,10)||0],l=a.style,h=r[0]+"px",f=r[1]+"px";l.left!==h&&(l.left=h),l.top!==f&&(l.top=f),c.setMapOffset(e.__mapOffset=r);o.dispatchAction({type:"tmapRoam",animation:{duration:0}})}};this.__moveHandlerPerformance&&r.off("move",this._moveHandlerPerformance),this._resizeHandler&&r.off("resize",this._resizeHandler),this._moveStartHandler&&r.off("movestart",this._moveStartHandler),this._moveEndHandler&&(r.off("moveend",this._moveEndHandler),r.off("zoomend",this._moveEndHandler)),this._moveHandler=m,l?(this._moveHandlerPerformance=t.throttle(m,14,!0),r.on("move",this._moveHandlerPerformance)):r.on("movestart",this._moveStartHandler=function(){setTimeout((function(){e.setEChartsLayerVisibility(!1)}),0)});var d=this._moveEndHandler=function(t){m(),setTimeout((function(){e.setEChartsLayerVisibility(!0)}),20)};if(r.on("moveend",d),r.on("zoomend",d),h){var p=function(){t.getInstanceByDom(o.getDom()).resize()};f&&(p=t.throttle(p,20,!0)),r.on("resize",this._resizeHandler=p)}this._isFirstRender=i=!1},dispose:function(){r={};var e=this.__model;if(e){var t=e.getRoot();t&&(t.innerHTML=""),e.setTMap(null),e.setEChartsLayer(null),e.coordinateSystem&&(e.coordinateSystem.setTMap(null),e.coordinateSystem=null),delete this._moveHandler,delete this._resizeHandler,delete this._moveStartHandler,delete this._moveEndHandler,delete this._moveHandlerPerformance}}},d=o?t.ComponentView.extend(m):m;function p(e){(!o||5==n[0]&&n[1]<4)&&e.registerLayout((function(e){e.eachSeriesByType("pie",(function(e){var t=e.coordinateSystem,n=e.getData(),o=n.mapDimension("value");if(t&&t.type===i){var r=e.get("center"),a=t.dataToPoint(r),s=a[0],c=a[1];n.each(o,(function(e,t){var o=n.getItemLayout(t);o.cx=s,o.cy=c}))}}))})),o?e.registerComponentModel(f):e.extendComponentModel(f),o?e.registerComponentView(d):e.extendComponentView(d),e.registerCoordinateSystem(i,c),e.registerAction({type:i+"Roam",event:i+"Roam",update:"updateLayout"},(function(e,t){t.eachComponent(i,(function(e){var t=e.getTMap(),n=t.getCenter();e.setCenterAndZoom([n.lng,n.lat],t.getZoom())}))}))}o?t.use(p):p(t),e.name="echarts-extension-tmap",e.version="1.0.0"}));
//# sourceMappingURL=echarts-extension-tmap.min.js.map
